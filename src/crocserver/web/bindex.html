<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>Croc</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="description" content="">
        <meta name="author" content="">

        <link href="./bootstrap/css/bootstrap.css" rel="stylesheet">
        <style type="text/css">
            body {
                padding-top: 60px;
                padding-bottom: 40px;
            }
            .sidebar-nav {
                padding: 9px 0;
            }
        </style>
        <link href="./bootstrap/css/bootstrap-responsive.css" rel="stylesheet">

        <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
        <!--[if lt IE 9]>
          <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->

        <!-- Fav and touch icons -->
        <link rel="shortcut icon" href="./bootstrap/ico/favicon.ico">
        <link rel="apple-touch-icon-precomposed" sizes="144x144" href="./bootstrap/ico/apple-touch-icon-144-precomposed.png">
        <link rel="apple-touch-icon-precomposed" sizes="114x114" href="./bootstrap/ico/apple-touch-icon-114-precomposed.png">
        <link rel="apple-touch-icon-precomposed" sizes="72x72" href="./bootstrap/ico/apple-touch-icon-72-precomposed.png">
        <link rel="apple-touch-icon-precomposed" href="./bootstrap/ico/apple-touch-icon-57-precomposed.png">
    </head>

    <body>

        <div class="navbar navbar-inverse navbar-fixed-top">
            <div class="navbar-inner">
                <div class="container-fluid">
                    <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </a>
                    <a class="brand" href="#">Croc</a>
                    <div class="nav-collapse collapse">
                        <div id="croc-username" class="navbar-text pull-right">
                            <a href="#" id="croc-username-text" class="navbar-link">username</a>
                        </div>
                        <div id="croc-login" class="nav pull-right">
                            <a id="croc-login-btn"><span class="btn">Login with Google</span></a>
                        </div>
                        <ul class="nav">
                            <li class="croc-nav-anchor croc-home-anchor active"><a href="#">Home</a></li>
                            <li><a class="croc-nav-anchor croc-about-anchor" href="#">About</a></li>
                            <li><a class="croc-nav-anchor croc-contact-anchor" href="#">Contact</a></li>
                        </ul>
                        <!--form class="navbar-form pull-right">
                          <input class="span2" type="text" placeholder="Email">
                          <input class="span2" type="password" placeholder="Password">
                          <button type="submit" class="btn">Sign in</button>
                        </form-->
                    </div><!--/.nav-collapse -->
                </div>
            </div>
        </div>

        <div class="container-fluid">
            <div class="row-fluid">
                <div class="span3">
                    <div class="well sidebar-nav">
                        <ul class="nav nav-list">
                            <li class="nav-header">Site</li>
                            <li class="croc-home-anchor croc-nav-anchor active"><a href="#">Home</a></li>
                            <li class="nav-header">Admin</li>
                            <li><a href="#">Dashboard</a></li>
                            <li><a href="#"></a></li>
                        </ul>
                    </div><!--/.well -->
                </div><!--/span-->
                <div class="span9">
                    <div class="hero-unit croc-info" id="croc-info-landing">
                        <h1>Croc</h1>
                        <p>
                        <p>Croc is the "cron output collector"</p>
                        <p><a class="btn btn-primary btn-large">Learn more &raquo;</a></p>
                    </div>
                    <div class="hero-unit croc-info" id="croc-info-contact">
                        <h1>Contact</h1>
                        <p>
                        <p>evan.summers at gmail.com</p>
                    </div>
                    <div class="hero-unit croc-info" id="croc-info-about">
                        <h1>About</h1>
                        <p>
                        <p>Croc is the "cron output collector"</p>
                        <p>Developed by evan.summers at gmail.com</p>
                    </div>
                </div><!--/span-->
            </div><!--/row-->

            <hr>
            <footer>
                <!--p>Built using Bootstrap in November 2012</p-->
            </footer>

        </div><!--/.fluid-container-->

    </body>

    <script src="./bootstrap/js/jquery.js"></script>
    <script src="./bootstrap/js/bootstrap-transition.js"></script>
    <script src="./bootstrap/js/bootstrap-alert.js"></script>
    <script src="./bootstrap/js/bootstrap-modal.js"></script>
    <script src="./bootstrap/js/bootstrap-dropdown.js"></script>
    <script src="./bootstrap/js/bootstrap-scrollspy.js"></script>
    <script src="./bootstrap/js/bootstrap-tab.js"></script>
    <script src="./bootstrap/js/bootstrap-tooltip.js"></script>
    <script src="./bootstrap/js/bootstrap-popover.js"></script>
    <script src="./bootstrap/js/bootstrap-button.js"></script>
    <script src="./bootstrap/js/bootstrap-collapse.js"></script>
    <script src="./bootstrap/js/bootstrap-carousel.js"></script>
    <script src="./bootstrap/js/bootstrap-typeahead.js"></script>

    <script type="text/javascript">  
        var accessToken;
        var tokenType;
        var expiresIn;
        var user;

        function click_login_google() {
            var loginUrl = '${loginUrl}';
            var win = window.open(loginUrl, "Login with Google", 'width=800, height=600'); 
            var pollTimer =  window.setInterval(function() { 
                if (win.document.URL.indexOf('${redirectUri}') != -1) {
                    window.clearInterval(pollTimer);
                    var url = win.document.URL;
                    win.close();
                    var index = url.indexOf('#');
                    if (index > 0) {
                        var queryString = url.substring(index + 1);
                        var regex = /([^&=]+)=([^&]*)/g;
                        while (true) {
                            var m = regex.exec(queryString)
                            if (m == null) break; 
                            if (m[1] == 'access_token') accessToken = m[2];
                        }
                        validateToken(accessToken);
                    }
                }
            }, 100);
        }

        function validateToken(token) {
            $.ajax({
                url: 'https://www.googleapis.com/oauth2/v1/tokeninfo?access_token=' + token,
                data: null,
                success: function(response){  
                    console.log(response);
                    getUserInfo();
                },  
                dataType: "jsonp"  
            });
        }

        function getUserInfo() {
            $.ajax({
                url: 'https://www.googleapis.com/oauth2/v1/userinfo?access_token=' + accessToken,
                data: null,
                success: function(user) {
                    console.log(user);                    
                    $('#croc-login-btn').hide();
                    $('#croc-username').show();
                    $('#croc-username-text').text(user.email);
                    //$('#imgHolder').attr('src', user.picture);
                },
                dataType: "jsonp"
            });
        }

        $(document).ready(function() {
            $("#croc-username").hide();
            $(".croc-info").hide();
            $("#croc-info-landing").show();
            $(".croc-home-anchor").click(function() {
                $(".croc-nav-anchor").removeClass("active");
                $(".croc-info").hide();
                $("#croc-info-landing").show();
            });
            $(".croc-contact-anchor").click(function() {
                $(".croc-info").hide();
                $(".croc-nav-anchor").removeClass("active");
                $("#croc-info-contact").removeClass("hidden")
                $("#croc-info-contact").show();
            });
            $(".croc-about-anchor").click(function() {
                $(".croc-info").hide();
                $(".croc-nav-anchor").removeClass("active");
                $("#croc-info-about").removeClass("hidden")
                $("#croc-info-about").show();
            });
            $("#croc-login-btn").click(function() {
                click_login_google();
            });
        });
    </script>
</html>
