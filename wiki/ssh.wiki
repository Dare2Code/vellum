= ssh = 

http://linux.byexamples.com/archives/297/how-to-ssh-without-password/

If you google ssh-keygen, you should find lots of examples sometimes entitled "ssh without password" for installing a public key on server eg. server for ssh.

=== ssh-keygen === 

In short, we generate a key pair using ssh-keygen (or PuTTYgen on Windows).

<pre>
$ ssh-keygen -t rsa
</pre>

This creates two files as follows ~/.ssh/id_rsa.pub (public key), and ~/.ssh/id_rsa (private key).

The first is the public key, which we give out to servers e.g. using scp, or ssh-copy-id.

The private key is install on our workstations.

Since the private key gives access to the remote server to whoever has this key, it is important to protect it with a passphrase. This passphrase is used to encrypt/decrypt the file in which the private key is stored.

=== ssh-agent === 

To avoid the inconvenience of having to enter the passphrase every time ssh requires access to your private key (for a new remote ssh session), this passphrase can be cached by ssh-agent. We use ssh-add to activate ssh-agent for your session, and add your decrypted private key info to the agent to use for authentication.

<pre>
[evanx@mozart ~]$ ps x | grep ssh-agent
26995 ?        Ss     0:00 ssh-agent /bin/bash

[evanx@mozart ~]$ ssh-add
Identity added: /home/evanx/.ssh/identity (/home/evanx/.ssh/identity)
</pre>

ssh-agent is usually started for your shell by default but is inactive until ssh-add is invoked, and this will prompt for the passphrase for the encrypted private key to be cached by ssh-agent.
If ssh-agent is not running, it can be started as follows.

<pre>
evanx@mozart ~$ ssh-agent bash
evanx@mozart ~$ ssh-add 
</pre>

===  ssh-copy-id === 

We append the public key to ~/.ssh/authorized_keys on servers e.g. using the ssh-copy-id command.

The private key you can copy into the .ssh/ directory on your home Linux PC, or install into putty, your phone etc.

Alternatively you can generate a new public/private key pair on each workstation PC (or smartphone) and repeat the ssh-copy-id procedure.

If the ssh-copy-id command is not available, you can scp the public the key to the server, and manually append it to .ssh/authorized_keys as follows

<pre>
$ cat id_rsa.pub >> .ssh/authorized_keys
</pre>

If you are creating authorized_keys you need to chmod is as follows.

<pre>
$ chmod 600 .ssh/authorized_keys
</pre>

=== Trouble-shooting === 

Also ensure that your .ssh directory permissions are correct.

<pre>
$ chmod 700 .ssh
</pre>

If you are having problems, run ssh with -vvv option to see debugging info.

<pre>
$ ssh -vvv -p 2200 bizswitch.net 
</pre>

If that doesn't give an indication of the problem, we need to look in sshd logs on the server.

On Ubuntu:

<pre>
root@mozart:~# tail /var/log/auth.log
Mar 17 13:48:30 evanx sshd[27543]: Failed password for postgres from 192.168.15.4 port 56867 ssh2
</pre>

On CentOS:

<pre>
root@server ~: tail /var/log/secure
Mar 17 13:50:01 server sshd[2044]: Failed password for invalid user postgres from 192.168.16.191 port 52575 ssh2
</pre>

Finally we can run sshd in debug mode using -d option.

<pre>
root@server ~: /usr/sbin/sshd -p 2200 -d 
debug1: sshd version OpenSSH_4.3p2
</pre>

Then when we ssh to that port and view the debugging information that it will output to the console.

<pre>
evanx@mozart:~$ ssh -vvv -p 2200 server
</pre>

=== Port forwarding === 

<pre>
ssh bizswitch.net -p2200 -L 2204:biz4:22 -L 2202:dev2:22
ssh localhost -p2202
</pre>